<html>
<head>
<body class="initial">
	<div class="messages">
		<h1>Watch out for the Curve</h1>
	</div>
</body>

<script src="https://www.gstatic.com/cast/js/receiver/1.0/cast_receiver.js"></script>
<script src="CurveGame.js"></script>
<script>
	var gameManager;
	var castReceiverManager = cast.receiver.CastReceiverManager.getInstance();

	window.onload = function() {
	console.log('On load' );
	  var appConfig = new cast.receiver.CastReceiverManager.Config();
	  appConfig.statusText = 'My Game is getting ready';
	  appConfig.maxInactivity = 6000;  // 100 minutes for testing only.

	  var gameConfig = new cast.receiver.games.GameManagerConfig();
	  gameConfig.applicationName = 'Watch out for the Curve';
	  gameConfig.maxPlayers = 10;
	  gameManager = new cast.receiver.games.GameManager(gameConfig);

	  castReceiverManager.start(appConfig);
	  startGame();
	};
	
	
	
	var startGame = function(){
		game = new CurveGame(gameManager);
		gameManager.addGameManagerListener(game);
		console.log('Game started' );
	};
	
	
	var customMessageBus = castReceiverManager.getCastMessageBus('urn:x-cast:curvefever');
	customMessageBus.onMessage = function(event) {
		console.log('Message received' );
	}
	
	//Handle device dissconnecting from the receiver
	window.castReceiverManager.onSenderDisconnected = function(event) {
		if(window.castReceiverManager.getSenders().length == 0 &&
			event.reason == cast.receiver.system.DisconnectReason.REQUESTED_BY_SENDER) {
			window.close();
		}
	}
	
</script>

</html>